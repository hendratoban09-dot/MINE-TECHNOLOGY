<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>MINE TECHNOLOGY - Highwall Safety Monitor</title>

<style>
:root{
  --green:#1b8f3a;
  --blue:#0a4f70;
  --orange:#f28c28;
  --bg:#f4f6f8;
}
body{
  margin:0;
  font-family:Arial,Helvetica,sans-serif;
  background:var(--bg);
}
h3{
  color:var(--blue);
  border-left:6px solid var(--green);
  padding-left:10px;
}
button{
  background:var(--green);
  color:white;
  border:none;
  padding:8px 14px;
  border-radius:4px;
  cursor:pointer;
  font-weight:bold;
}
button:hover{background:var(--blue);}
canvas{
  border:3px solid var(--green);
  border-radius:6px;
  background:white;
  cursor:crosshair;
}
input,select{
  padding:6px;
  border-radius:4px;
  border:1px solid #ccc;
}
#loginBox{
  position:fixed;
  inset:0;
  background:linear-gradient(135deg,var(--green),var(--blue));
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:9999;
}
#loginForm{
  background:white;
  padding:25px;
  width:320px;
  border-radius:10px;
  text-align:center;
}
#error{color:red;font-size:12px;}
#app{display:none;padding:20px;}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginBox">
  <div id="loginForm">
    <h3>MINE TECHNOLOGY</h3>
    <input id="user" placeholder="Username"><br><br>
    <input id="pass" type="password" placeholder="Password"><br><br>
    <button onclick="login()">LOGIN</button>
    <p id="error"></p>
  </div>
</div>

<!-- APLIKASI -->
<div id="app">
  <h3>Highwall Safety Monitor</h3>

  <input type="file" id="upload" accept="image/*"><br><br>

  <label>Referensi (meter):</label>
  <input type="number" id="refMeter" value="1" step="0.01">

  <select id="orientation">
    <option value="vertical">Vertikal</option>
    <option value="horizontal">Horizontal</option>
    <option value="free">Bebas</option>
  </select>

  <br><br>

  <button onclick="setMode('kalibrasi')">Kalibrasi</button>
  <button onclick="setMode('ukur')">Ukur</button>
  <button onclick="resetAll()" style="background:var(--orange)">Reset</button>

  <br><br>

  <label>Inspektor:</label>
  <input type="text" value="Hendra Toban">
  <label>Front:</label>
  <input type="text" placeholder="Front / Lokasi">

  <br><br>

  <canvas id="canvas"></canvas>
  <p id="info"></p>
</div>

<script>
/* LOGIN */
const USERNAME="MARKO";
const PASSWORD="MARKO01";
function login(){
  if(user.value===USERNAME && pass.value===PASSWORD){
    loginBox.style.display="none";
    app.style.display="block";
  } else {
    error.innerText="Username atau password salah";
  }
}

/* LOGIC */
const MIN=4, MAX=8;
const canvas=document.getElementById("canvas");
const ctx=canvas.getContext("2d");
const upload=document.getElementById("upload");
const orient=document.getElementById("orientation");
const refMeter=document.getElementById("refMeter");
const info=document.getElementById("info");

let img=new Image(),mode="kalibrasi";
let pixelPerMeter=null,temp=[],lines=[];

upload.onchange=e=>{
  const r=new FileReader();
  r.onload=()=>{img.onload=()=>{canvas.width=img.width;canvas.height=img.height;draw();};img.src=r.result;}
  r.readAsDataURL(e.target.files[0]);
};

canvas.onclick=e=>{
  if(!img.src)return;
  const r=canvas.getBoundingClientRect();
  let p={x:e.clientX-r.left,y:e.clientY-r.top};
  if(temp.length===1){
    let t=temp[0];
    if(orient.value==="vertical")p.x=t.x;
    if(orient.value==="horizontal")p.y=t.y;
  }
  temp.push(p);
  if(temp.length===2){
    let d=Math.hypot(temp[0].x-temp[1].x,temp[0].y-temp[1].y);
    if(mode==="kalibrasi"){
      pixelPerMeter=d/refMeter.value;
      info.innerHTML="Skala: "+pixelPerMeter.toFixed(2)+" px/m";
    } else lines.push([...temp]);
    temp=[];
  }
  draw();
};

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  if(img.src)ctx.drawImage(img,0,0);
  lines.forEach(l=>{
    let m=Math.hypot(l[0].x-l[1].x,l[0].y-l[1].y)/pixelPerMeter;
    ctx.strokeStyle=(m<MIN||m>MAX)?"red":"blue";
    ctx.beginPath();
    ctx.moveTo(l[0].x,l[0].y);
    ctx.lineTo(l[1].x,l[1].y);
    ctx.stroke();
    ctx.fillText(m.toFixed(2)+" m",(l[0].x+l[1].x)/2,(l[0].y+l[1].y)/2);
  });
}

function setMode(m){mode=m;}
function resetAll(){lines=[];pixelPerMeter=null;draw();}
</script>

</body>
</html>
